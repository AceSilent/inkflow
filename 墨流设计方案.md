 **“墨流 (InkFlow) AI 创作辅助器”** 深度方案。

---

### 一、 视觉方案：现代简约主义 (Minimalist UI)

*   **色调：** 采用“纸张白”或“深空灰”为主色。使用非高反差的文字颜色（如 `#2c3e50`），减少长时间写作的视觉疲劳。
*   **布局：** 三栏式响应式布局。
    *   **左侧（资源管理器）：** 树状结构展示小说-章节，支持拖拽排序。
    *   **中间（沉浸式编辑器）：** 核心区域。无边框设计，只有文字。
    *   **右侧（辅助侧边栏）：** 选项卡切换“大纲管理”与“AI 讨论区”。
*   **动效：** 所有的面板切换采用淡入淡出，AI 续写文字逐字浮现（Typewriter Effect）或灰度显示。

---

### 二、 核心交互逻辑

#### 1. 幽灵文字 (Ghost Text) 与 Tab 键
*   **技术实现：** 基于 **Monaco Editor** (VS Code 的核心编辑器) 或 **TipTap** 开发。
*   **交互：** 
    *   当 AI 触发生成后，建议内容以 `#999`（浅灰色）接在光标后。
    *   按下 `Tab`：接受全部建议。
    *   按下 `Ctrl + ->`：接受下一个单词/句子。
    *   继续打字：建议内容自动消失。

#### 2. 智能触发器 (Idle Trigger)
*   **逻辑：** 设置一个 `Debounce` 定时器（默认 2-3 秒）。用户停止输入时，自动发送请求给 AI。
*   **状态提示：** 在底部状态栏显示一个小呼吸灯或“AI 正在思考...”的微弱文字，避免干扰思绪。

#### 3. 悬浮反馈对话框 (Refinement UI)
*   **设计：** 当幽灵文字出现时，文字上方浮现一个极简的输入框（类似 Raycast 或预览框）。
*   **功能：** 如果用户不满意，直接输入“让他们打起来”或“这段太煽情了，要冷酷点”，AI 会结合之前的上下文重新生成幽灵文字。

---

### 三、 文件管理与目录结构

软件采用**基于文件夹**的工作流，方便用户使用云盘同步或 Git 版本控制。

```text
Working_Directory/
├── 小说名A/
│   ├── config.json          # 记录当前小说的大纲、模型设置
│   ├── outline.md           # 总大纲
│   ├── 001_第一章.txt
│   ├── 001_第一章_summary.json # 自动生成的章节细纲
│   └── 002_第二章.txt
└── 小说名B/
```

*   **状态恢复：** 软件退出时保存 `last_opened.json`，记录最后打开的文件路径、光标行号及滚动条位置。

---

### 四、 AI 上下文引擎 (Context Engine)

这是该软件的核心技术逻辑，解决“AI 越写越乱”的问题。

#### 1. 提示词构造逻辑 (Prompt Construction)
当光标在第 N 章某位置时，发送给 AI 的 Prompt 结构：
1.  **全局设定：** {outline.md} 内容。
2.  **前情提要：** 第 N-2 章细纲 + 第 N-1 章细纲。
3.  **本章目标：** 第 N 章已生成的细纲（告诉 AI 本章该发生什么）。
4.  **正文环境：** 第 N 章光标前 2000 字内容。
5.  **光标标记：** 使用特殊占位符 `[CURSOR]` 告知 AI 从此处开始续写。

#### 2. 细纲管理
*   **自动生成：** 每一章写完后，AI 自动在后台生成一份 300 字以内的“章节小结（细纲）”。
*   **手动干预：** 用户可以在侧边栏修改本章细纲，强制修正 AI 的后续走向。

---

### 五、 核心功能模块详细设计

#### 1. AI 讨论区 (Brainstorming Window)
*   提供一个专门的对话窗口，不直接修改正文。
*   **功能：** “我想在第 10 章安排主角黑化，逻辑上怎么铺垫比较好？”
*   **同步：** 讨论得出的结论可以一键“应用到大纲”。

#### 2. 自定义模型配置
*   支持主流 API：OpenAI (GPT-4o), Anthropic (Claude 3.5), DeepSeek (性价比最高), 以及本地 Ollama 部署。
*   **高级参数：** 为每个小说单独设置 `Temperature`（随机性）。写诗意片段调高，写严谨推理调低。

---

### 六、 开发建议（技术栈）

*   **前端框架：** **Electron** 或 **Tauri** (推荐 Tauri，体积小，性能好)。
*   **编辑器：** **ProseMirror**。它处理富文本和装饰器（Decorations）非常强大，比 Monaco 更适合做长篇文字排版。
*   **状态管理：** Zustand 或 Redux。
*   **本地数据库：** SQLite (用于快速检索章节记录)。

---

### 七、 人机交互亮点 (The "Wow" Factors)

1.  **打字机模式：** 始终让当前编辑行保持在屏幕正中央。
2.  **专注模式：** 侧边栏自动隐藏，只剩下正文。
3.  **版本对比：** 针对 AI 重新生成的建议，支持左右分屏对比，像 Git Diff 一样查看改动。
4.  **快捷键：** 
    *   `Alt + L`：手动强行触发 AI 续写。
    *   `Cmd/Ctrl + K`：打开 AI 修改对话框。
