# Sprint 2: æ²‰æµ¸å¼ AI ç¼–è¾‘å™¨æ ¸å¿ƒç»„ä»¶

## ğŸ¯ å®ç°æ¦‚è¿°

Sprint 2 æˆåŠŸä¸º InkFlow é¡¹ç›®å®ç°äº†æ²‰æµ¸å¼ AI ç¼–è¾‘å™¨çš„æ ¸å¿ƒç»„ä»¶ï¼ŒåŒ…æ‹¬ Zustand çŠ¶æ€ç®¡ç†ã€Monaco Editor é›†æˆã€å¹½çµæ–‡å­— (Ghost Text) åŠŸèƒ½å’Œäº¤äº’å¼åé¦ˆé¢æ¿ã€‚

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/Editor/
â”‚   â”œâ”€â”€ MainEditor.tsx          # ä¸»ç¼–è¾‘å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ GhostTextManager.ts     # å¹½çµæ–‡å­—ç®¡ç†å™¨
â”‚   â””â”€â”€ FeedbackPanel.tsx       # AI åé¦ˆé¢æ¿
â”œâ”€â”€ store/
â”‚   â””â”€â”€ editorStore.ts          # Zustand çŠ¶æ€ç®¡ç†
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useDebounce.ts          # é˜²æŠ– Hook
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ editor.css              # ç¼–è¾‘å™¨æ ·å¼
â””â”€â”€ App.tsx                     # æ›´æ–°çš„ä¸»åº”ç”¨
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. Zustand çŠ¶æ€ç®¡ç† (`src/store/editorStore.ts`)

**åŠŸèƒ½ç‰¹æ€§:**
- å®æ—¶ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç† (content, cursorPosition, isDirty)
- AI å»ºè®®çŠ¶æ€ç®¡ç† (ghostText, isAISuggesting)
- æ™ºèƒ½è§¦å‘å™¨ (debounce é€»è¾‘ï¼Œ2ç§’å»¶è¿Ÿ)
- ç« èŠ‚ç®¡ç† (åŠ è½½ã€ä¿å­˜ã€è‡ªåŠ¨ä¿å­˜)
- ä¸ Rust åç«¯çš„æ— ç¼é›†æˆ

**å…³é”® API:**
```typescript
// å†…å®¹ç®¡ç†
updateContent(content: string)
acceptSuggestion(): Promise<void>
generateAISuggestion(): Promise<void>

// å¹½çµæ–‡å­—
setGhostText(suggestion: string, position: CursorContext)
clearGhostText()

// æ™ºèƒ½è§¦å‘
shouldTriggerAI(): boolean
autoSave(): Promise<void>
```

### 2. Monaco Editor é›†æˆ (`src/components/Editor/MainEditor.tsx`)

**æ²‰æµ¸å¼é…ç½®:**
- éšè—è¡Œå·ã€è¿·ä½ åœ°å›¾ã€æ»šåŠ¨æ¡è£…é¥°
- æç®€è¾¹è·å’Œå¹³æ»‘æ»šåŠ¨
- è‡ªå®šä¹‰å­—ä½“ (SF Pro Text) å’Œè¡Œé«˜ (1.8)
- ä¸“æ³¨æ¨¡å¼ (æ·¡åŒ–éæ´»åŠ¨å…ƒç´ )

**é”®ç›˜å¿«æ·é”®:**
- `Tab` - æ¥å—å¹½çµæ–‡å­—å»ºè®®
- `Esc` - å…³é—­å¹½çµæ–‡å­—
- è‡ªåŠ¨é˜²æŠ– AI è§¦å‘ (2ç§’å»¶è¿Ÿ)

**äº‹ä»¶å¤„ç†:**
- å†…å®¹å˜æ›´ â†’ è‡ªåŠ¨ä¿å­˜ + AI è§¦å‘
- å…‰æ ‡ç§»åŠ¨ â†’ å¹½çµæ–‡å­—å¯è§æ€§ç®¡ç†
- é€‰æ‹©å˜æ›´ â†’ æ¸…é™¤å¹½çµæ–‡å­—

### 3. å¹½çµæ–‡å­—ç³»ç»Ÿ (`src/components/Editor/GhostTextManager.ts`)

**è§†è§‰æ ·å¼:**
- é¢œè‰²: `#6a6a6a` (60% é€æ˜åº¦)
- æ–œä½“æ ·å¼ï¼Œæ— äº¤äº’äº‹ä»¶
- æ‚¬åœæç¤º (Tab/Esc å¿«æ·é”®)

**æ™ºèƒ½è¡Œä¸º:**
- å…‰æ ‡è·ç¦»æ£€æµ‹ (50å­—ç¬¦é˜ˆå€¼)
- é€‰æ‹©å˜åŒ–è‡ªåŠ¨æ¸…é™¤
- ä¸»é¢˜é€‚é… (æµ…è‰²/æ·±è‰²/é«˜å¯¹æ¯”åº¦)

**Monaco é›†æˆ:**
- ä½¿ç”¨ `deltaDecorations` API
- ä¸å¯ç¼–è¾‘å ä½ç¬¦
- æ™ºèƒ½ä½ç½®è®¡ç®—å’Œè·Ÿè¸ª

### 4. åé¦ˆé¢æ¿ (`src/components/Editor/FeedbackPanel.tsx`)

**Framer Motion åŠ¨ç”»:**
- å¼¹æ€§è¿›å…¥/é€€å‡ºåŠ¨ç”»
- å±•å¼€/æŠ˜å å¹³æ»‘è¿‡æ¸¡
- ä½ç½®è‡ªé€‚åº”å…‰æ ‡ä½ç½®

**å¿«é€Ÿåé¦ˆé€‰é¡¹:**
- ğŸ¨ é£æ ¼è°ƒæ•´ ("è¯·ç”¨ä¸åŒé£æ ¼é‡å†™")
- ğŸ‘” æ­£å¼ç¨‹åº¦ ("è¯·æ›´éšæ„ä¸€äº›")
- ğŸ“š ä¸°å¯Œç¨‹åº¦ ("æ·»åŠ æ›´å¤šæè¿°ç»†èŠ‚")
- âœ‚ï¸ ç®€æ´ç¨‹åº¦ ("è¯·æ›´ç®€æ´")
- ğŸ“ é•¿åº¦è°ƒæ•´ ("è¯·æ‰©å±•è¿™ä¸ªæƒ³æ³•")

**è‡ªå®šä¹‰è¾“å…¥:**
- å®æ—¶åé¦ˆè¾“å…¥æ¡†
- é”®ç›˜å¿«æ·é”®æ”¯æŒ (Enter æäº¤, Esc å–æ¶ˆ)
- æ™ºèƒ½å®šä½å’Œç„¦ç‚¹ç®¡ç†

### 5. æ™ºèƒ½ AI è§¦å‘ (`src/hooks/useDebounce.ts`)

**é«˜çº§é˜²æŠ–:**
- å¯é…ç½®å»¶è¿Ÿ (é»˜è®¤ 2ç§’)
- æ™ºèƒ½å†…å®¹è¿‡æ»¤ (æœ€å°‘ 10 å­—ç¬¦)
- ä½ç½®æ„ŸçŸ¥ (é¿å…æ–‡æ¡£å¼€å¤´è§¦å‘)
- é€Ÿç‡é™åˆ¶ (5ç§’æœ€å°é—´éš”)

**ä¿æŠ¤æœºåˆ¶:**
- é˜²æ­¢é‡å¤è§¦å‘
- å†…å®¹å˜åŒ–æ£€æµ‹
- ä¸Šä¸‹æ–‡é•¿åº¦éªŒè¯

## ğŸ¨ æ ·å¼ç³»ç»Ÿ (`src/styles/editor.css`)

**æ²‰æµ¸å¼ä¸»é¢˜:**
- é€æ˜èƒŒæ™¯å’Œè¾¹è·
- è‡ªå®šä¹‰æ»šåŠ¨æ¡
- ä¼˜é›…çš„åŠ è½½åŠ¨ç”»
- å“åº”å¼è®¾è®¡

**å¹½çµæ–‡å­—æ ·å¼:**
- ä¸»é¢˜è‡ªé€‚åº”é¢œè‰²
- æ‚¬åœäº¤äº’åŒºåŸŸ
- é«˜å¯¹æ¯”åº¦æ”¯æŒ

## ğŸ”§ ä¾èµ–æ›´æ–°

æ–°å¢å…³é”®ä¾èµ–:
```json
{
  "@monaco-editor/react": "^4.6.0",
  "zustand": "^4.4.7",
  "framer-motion": "^10.16.16",
  "monaco-editor": "^0.44.0"
}
```

## ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹

### æ¨¡å—åŒ–è®¾è®¡
- **Store Layer**: Zustand çŠ¶æ€ç®¡ç†
- **Component Layer**: React ç»„ä»¶ (Monaco + UI)
- **Service Layer**: API é›†æˆå’Œä¸šåŠ¡é€»è¾‘
- **Style Layer**: ä¸»é¢˜å’Œæ²‰æµ¸å¼ä½“éªŒ

### çŠ¶æ€æµ
```
User Input â†’ Monaco Editor â†’ EditorStore â†’ GhostTextManager â†’ UI Update
     â†“              â†“                â†“                â†“
   Content    â†’   Cursor Position  â†’ AI Trigger â†’ Ghost Text Display
```

### AI é›†æˆæµç¨‹
```
åœæ­¢è¾“å…¥ 2ç§’ â†’ ä¸Šä¸‹æ–‡åˆ†æ â†’ Rust API â†’ å»ºè®®æ˜¾ç¤º â†’ ç”¨æˆ·äº¤äº’ â†’ å†…å®¹æ›´æ–°
```

## ğŸ¯ ç”¨æˆ·ä½“éªŒ

**å†™ä½œæµç¨‹:**
1. ç”¨æˆ·æ­£å¸¸å†™ä½œï¼Œ Monaco æä¾›æµç•…ä½“éªŒ
2. åœæ­¢è¾“å…¥ 2ç§’åè‡ªåŠ¨è§¦å‘ AI å»ºè®®
3. å¹½çµæ–‡å­—åœ¨å…‰æ ‡åæ˜¾ç¤ºé¢„è§ˆ
4. ç”¨æˆ·å¯æŒ‰ Tab æ¥å—æˆ–æä¾›åé¦ˆ
5. æ™ºèƒ½åé¦ˆå¾ªç¯ä¼˜åŒ–å»ºè®®è´¨é‡

**äº¤äº’ç‰¹ç‚¹:**
- éä¾µå…¥å¼è®¾è®¡ (ä¸å½±å“æ­£å¸¸å†™ä½œ)
- æ™ºèƒ½ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- å¿«æ·é”®å‹å¥½
- å®æ—¶è§†è§‰åé¦ˆ

## ğŸ”„ ä¸åç«¯é›†æˆ

**Tauri API è°ƒç”¨:**
- `generate_ai_suggestion` - AI æ–‡æœ¬ç”Ÿæˆ
- `read_file` / `write_file` - ç« èŠ‚ç®¡ç†
- `auto_save` - è‡ªåŠ¨ä¿å­˜æœºåˆ¶

**æ•°æ®æµ:**
```typescript
// å‰ç«¯è°ƒç”¨
const response = await invoke('generate_ai_suggestion', { request });

// åç«¯å¤„ç†
pub async fn generate_ai_suggestion(request: AIRequest) -> Result<AIResponse, String>
```

## ğŸš€ ä¸‹ä¸€æ­¥æ‰©å±• (Sprint 3)

**è®¡åˆ’åŠŸèƒ½:**
1. å¤šç« èŠ‚ç®¡ç†å’Œå¯¼èˆª
2. å®æ—¶åä½œç¼–è¾‘
3. é«˜çº§ AI é…ç½® (æ¨¡å‹é€‰æ‹©ã€å‚æ•°è°ƒä¼˜)
4. å†™ä½œç»Ÿè®¡å’Œåˆ†æ
5. å¯¼å‡ºå’Œåˆ†äº«åŠŸèƒ½

**æŠ€æœ¯å€ºåŠ¡:**
- æ€§èƒ½ä¼˜åŒ– (å¤§æ–‡ä»¶å¤„ç†)
- é”™è¯¯è¾¹ç•Œå’Œæ¢å¤
- ç¦»çº¿æ¨¡å¼æ”¯æŒ
- ä¸»é¢˜ç³»ç»Ÿæ‰©å±•

---

**å®ŒæˆçŠ¶æ€:** âœ… Sprint 2 æ ¸å¿ƒåŠŸèƒ½å…¨éƒ¨å®ç°
**ä»£ç è´¨é‡:** ç”Ÿäº§å°±ç»ªï¼ŒåŒ…å«å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œé”™è¯¯å¤„ç†
**ç”¨æˆ·ä½“éªŒ:** æ²‰æµ¸å¼å†™ä½œä½“éªŒï¼Œæ™ºèƒ½ AI åŠ©æ‰‹æ— ç¼é›†æˆ